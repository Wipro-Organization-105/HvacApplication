name: HVAC Unit Tests (Testing Branch)

on:
  push:
    branches: [ Testing ]
  pull_request:
    branches: [ Testing ]

jobs:
  build-and-test:
    runs-on: self-hosted

    steps:
    - name: Setup AOSP Environment
      run: |
        cd /home/ubuntu/android-automotive
        source build/envsetup.sh
        lunch aosp_car_x86_64-userdebug

    - name: Run Unit Tests
      run: |
        cd /home/ubuntu/android-automotive
        echo "=== Building test module ==="
        m hvac-utils-test
        echo "=== Running unit tests ==="
        atest hvac-utils-test

    - name: Build APK
      run: |
        cd /home/ubuntu/android-automotive
        build/soong/soong_ui.bash --make-mode -j$(nproc) HvacApplication
