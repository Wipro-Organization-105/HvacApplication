name: HVAC Unit Tests (Testing Branch)

on:
  push:
    branches: [ testing ]
  pull_request:
    branches: [ testing ]

jobs:
  unit-tests:
    runs-on: self-hosted

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run HVAC Unit Tests (Soong)
        shell: bash
        run: |
          set -e

          echo "Moving to AOSP root"
          cd /home/ubuntu/android-automotive

          echo "Setting up build environment"
          source build/envsetup.sh

          echo "Selecting lunch target"
          lunch aosp_car_x86_64-userdebug

          echo "Building unit tests"
          m hvac-utils-test

          echo "Running unit tests"
          atest hvac-utils-test

          echo "Unit tests completed successfully"
